<!-- markdownlint-disable MD002 MD041 -->

В этом упражнении вы создадите последовательность для использования настраиваемого соединителя, созданного в предыдущих упражнениях, для создания и настройки группы Майкрософт. Этот процесс использует настраиваемый соединитель для отправки запроса POST на создание единой группы Office 365, приостанавливается на задержку при завершении создания группы, а затем отправляет запрос PUT для связи группы с командой Майкрософт.

В конце ваш процесс будет выглядеть примерно так, как показано на следующем рисунке:

![Снимок завершенного процесса](./images/flow-team1.png)

Откройте [Microsoft Flow](https://flow.microsoft.com) в браузере и войдите с помощью учетной записи администратора клиента Office 365. Выберите пункт **мои потоки** в левой панели навигации. Выберите **создать**, а затем **Создайте из пустого**. Выберите **создать из пустого**. Введите `Manual` в поле поиска и добавьте триггер **процесса вручную** .

Нажмите кнопку **Добавить вход**, выберите **текст** и введите `Name` название.

![Снимок экрана, запускающий триггер процесса вручную](./images/flow-team6.png)

Выберите **новый шаг** и введите `Batch` в поле поиска. Добавьте действие **пакетНого соединителя MS Graph** . Нажмите кнопку с многоточием и переименуйте это `Batch POST-groups`действие в.

Добавьте следующий код в поле **основного** текста действия.

```json
{
  "requests": [
    {
      "url": "/groups",
      "method": "POST",
      "id": 1,
      "headers": { "Content-Type": "application/json" },
      "body": {
        "description": "REPLACE",
        "displayName": "REPLACE",
        "groupTypes": ["Unified"],
        "mailEnabled": true,
        "mailNickname": "REPLACE",
        "securityEnabled": false
      }
    }
  ]
}
```

Замените каждый `REPLACE` заполнитель, выбрав `Name` значение из триггера вручную в меню **Добавление динамического содержимого** .

![Снимок меню динамического содержимого в Microsoft Flow](./images/flow-team2.png)

Выберите **новый шаг**, поиск `delay` и Добавление действия **задержки** и настройка в течение 1 минуты.

Выберите **новый шаг** и введите `Batch` в поле поиска. Добавьте действие **пакетНого соединителя MS Graph** . Нажмите кнопку с многоточием и переименуйте это `Batch PUT-team`действие в.

Добавьте следующий код в поле **основного** текста действия.

```json
{
  "requests": [
    {
      "id": 1,
      "url": "/groups/REPLACE/team",
      "method": "PUT",
      "headers": {
        "Content-Type": "application/json"
      },
      "body": {
        "memberSettings": {
          "allowCreateUpdateChannels": true
        },
        "messagingSettings": {
          "allowUserEditMessages": true,
          "allowUserDeleteMessages": true
        },
        "funSettings": {
          "allowGiphy": true,
          "giphyContentRating": "strict"
        }
      }
    }
  ]
}
```

Выберите `REPLACE` заполнитель, а затем выберите **выражение** в области динамический контент. Добавьте в **выражение**следующую формулу.

```js
body('Batch_POST-groups').responses[0].body.id
```

![Снимок экрана с выражением в области динамического содержимого](./images/flow-formula.png)

Эта формула указывает, что мы хотим использовать идентификатор группы из результата первого действия.

![Снимок экрана с обновленным текстом действия](./images/flow-team3.png)

Нажмите кнопку **сохранить**, а затем последовательно выберите пункты **тест** для выполнения последовательности.

> [!TIP]
> Если возникнет ошибка `The template validation failed: 'The action(s) 'Batch_POST-groups' referenced by 'inputs' in action 'Batch_2' are not defined in the template'`, выражение является неверным и, скорее всего, ссылается на действие, которое не удается найти. Убедитесь, что имя действия, на которое вы ссылаетесь, соответствует точно.

Выберите переключатель **я** выполню действие триггера и выберите команду **сохранить тест _амп_**. Нажмите кнопку **продолжить** в диалоговом окне. Введите имя без пробелов и выберите команду **выполнить поток** для создания команды.

![Снимок экрана с диалоговым окном потока запуска](./images/flow-team4.png)

Наконец, щелкните ссылку **действие выполнение потока** , а затем выберите запущенный поток, чтобы просмотреть журнал действий.

> [!NOTE]
> Чтобы просмотреть выполнение потока, может потребоваться щелкнуть запущенный экземпляр потока в списке Журнал выполнения.

По завершении процесса вы настроили группу и команду Office 365. Выберите элементы пакетного действия, чтобы просмотреть результаты пакетных вызовов JSON. `outputs` Действие должно иметь код состояния 201 для успешного сопоставления команды, как показано на рисунке `Batch PUT-team` ниже.

![Снимок журнала действий "успешный ход работы"](./images/flow-team5.png)